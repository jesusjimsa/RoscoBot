<?xml version="1.0" encoding="UTF-8"?>
	<aiml version="2.0">

	<!-- Falta:
			- Agregar evento
			- Cantidad de eventos
			- Modificar invitados, fecha, hora y título
			- Borrar evento, preguntando
			- Contar eventos de una fecha
														-->

	<!-- Regla  -->
	<category>
		<pattern>^ [añad guard nuevo]+ ^ ^ [cita evento reunion aviso recordatorio acontecimiento] ^</pattern>
		<template>
			De acuerdo, dime el titulo del evento
			<think>
				<set name="topic">nuevoEvento</set>
			</think>
		</template>
	</category>

	<topic name="nuevoEvento">
		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>DE ACUERDO, DIME EL TITULO DEL EVENTO</that>
			<template>
				<think>
					<set name="nuevoTitulo"><srai>ponerbarrabaja <star/></srai></set>
				</think>
				Guardado, dime ahora el año de <get name="nuevoTitulo"/>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>año_valido</set> ^</pattern>
			<that>GUARDADO, DIME AHORA EL AÑO DE *</that>
			<template>
				Ahora dime el mes del evento
				<think>
					<set name="nuevoAnio"><star index="2"/></set>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>DE ACUERDO, DIME EL AÑO DEL EVENTO</that>
			<template>
				Solo puedes decir uno del 2017 al 2027
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>año_valido</set> ^</pattern>
			<that>SOLO PUEDES DECIR UNO DEL 2017 AL 2027</that>
			<template>
				Ahora dime el mes del evento
				<think>
					<set name="nuevoAnio"><star index="2"/></set>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>mes_valido</set> ^</pattern>
			<that>AHORA DIME EL MES DEL EVENTO</that>
			<template>
				Dime ahora el dia
				<think>
					<set name="nuevoMes"><map name="mes_numero"><star index="2"/></map></set> 
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>mes_valido_num</set> ^</pattern>
			<that>AHORA DIME EL MES DEL EVENTO</that>
			<template>
				Dime ahora el dia
				<think>
					<set name="nuevoMes"><star index="2"/></set> 
					<condition name="nuevoMes">
						<li value="0"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="1"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="2"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="3"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="4"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="5"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="6"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="7"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="8"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="9"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>mes_valido_num</set> ^</pattern>
			<that>ESE MES NO EXISTE, INTRODUCE UN MES VALIDO</that>
			<template>
				Dime ahora el dia
				<think>
					<set name="nuevoMes"><star index="2"/></set>
					 <condition name="nuevoMes">
						<li value="0"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="1"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="2"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="3"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="4"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="5"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="6"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="7"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="8"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
						<li value="9"><set name="nuevoMes">0<get name="nuevoMes"></get></set></li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>AHORA DIME EL MES DEL EVENTO</that>
			<template>
				Ese mes no existe, introduce un mes valido
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>dias_validos</set> ^</pattern>
			<that>DIME AHORA EL DIA</that>
			<template>
				Ya tenemos la fecha, vamos ahora con la hora, primero dime la hora y despues si es a y media o no
				<think>
					<set name="nuevoDia"><star index="2"/></set>
					<condition name="nuevoDia">
						<li value="1"><set name="nuevoDia">01</set></li>
						<li value="2"><set name="nuevoDia">02</set></li>
						<li value="3"><set name="nuevoDia">03</set></li>
						<li value="4"><set name="nuevoDia">04</set></li>
						<li value="5"><set name="nuevoDia">05</set></li>
						<li value="6"><set name="nuevoDia">06</set></li>
						<li value="7"><set name="nuevoDia">07</set></li>
						<li value="8"><set name="nuevoDia">08</set></li>
						<li value="9"><set name="nuevoDia">09</set></li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>DIME AHORA EL DIA</that>
			<template>
				Ese no es un dia valido
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>hora_valida</set> ^</pattern>
			<that>YA TENEMOS LA FECHA, VAMOS AHORA CON LA HORA, PRIMERO DIME LA HORA Y DESPUES SI ES A Y MEDIA O NO</that>
			<template>
				Sera a y media?
				<think>
					<set name="nuevaHora"><star index="2"/></set>
					<condition name="nuevaHora">
						<li value="0"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="1"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="2"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="3"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="4"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="5"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="6"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="7"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="8"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="9"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>YA TENEMOS LA FECHA, VAMOS AHORA CON LA HORA. PRIMERO DIME LA HORA Y DESPUES SI ES A Y MEDIA O NO</that>
			<template>
				Esa no es una hora valida
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>^ <set>hora_valida</set> ^</pattern>
			<that>ESA NO ES UNA HORA VALIDA</that>
			<template>
				Sera a y media?
				<think>
					<set name="nuevaHora"><star index="2"/></set> 
					<condition name="nuevaHora">
						<li value="0"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="1"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="2"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="3"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="4"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="5"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="6"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="7"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="8"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
						<li value="9"><set name="nuevaHora">0<get name="nuevaHora"></get></set></li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>[Si Exacto Afirmativo Correcto] ^</pattern>
			<that>SERA A Y MEDIA</that>
			<template>
				<think>
					<set name="nuevaHora"><get name="nuevaHora"/>30</set>
				</think>
				La fecha completa es <set name="claveFecha"><get name="nuevoDia"/>/<get name="nuevoMes"/>/<get name="nuevoAnio"/></set> a las <get name="nuevaHora"/>
				<think>
					<set name="claveFechaHora"><get name="claveFecha"/>_<get name="nuevaHora"/></set> 
				</think>
				Va alguien contigo?
				<think>
					<set name="topic">invitados</set>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>[No Negativo Nope] ^</pattern>
			<that>SERA A Y MEDIA</that>
			<template>
				<think>
					<set name="nuevaHora"><get name="nuevaHora"/>00</set>
				</think>
				La fecha completa es <set name="claveFecha"><get name="nuevoDia"/>/<get name="nuevoMes"/>/<get name="nuevoAnio"/></set> a las <get name="nuevaHora"/> Va alguien contigo?
				<think>
					<set name="claveFechaHora"><get name="claveFecha"/>_<get name="nuevaHora"/></set> 
					<set name="topic">invitados</set>
				</think>
			</template>
		</category>
	</topic>

	<topic name="invitados">
		<!-- Regla  -->
		<category>
			<pattern>[Si Exacto Afirmativo Correcto] ^</pattern>
			<that>LA FECHA COMPLETA ES *</that>
			<template>
				Como se llama?
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>*</pattern>
			<that>COMO SE LLAMA</that>
			<template>
				Vale, lo guardo Alguien mas?
				<think>
					<condition name="nuevoInvitado">
						<li value="unknown"><set name="nuevoInvitado"><star/></set></li>
						<li><set name="nuevoInvitado"><get name="nuevoInvitado"/>/<star/></set> </li>
					</condition>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>[No Negativo Nope] ^</pattern>
			<that>LA FECHA COMPLETA ES *</that>
			<template>
				Vale, ya esta registrado tu evento en el calendario
				<think>
					<addtomap>	<!-- Guardar eventos en un mapa con fecha_hora:titulo -->
						<name>evento</name>
						<key><get name="claveFechaHora"/></key>
						<value><get name="nuevoTitulo"/></value>
					</addtomap>
					<addtomap>
						<name>evper</name>	<!-- Guardar eventos en un mapa con fecha_hora:invitados -->
						<key><get name="claveFechaHora"/></key>
						<value><get name="nuevoInvitado"/></value>
					</addtomap>
					<set var="condicion"><map name="fecha_horas"><get name="claveFecha"/></map></set>
					<condition var="condicion">	<!-- Comprobar si ya tiene ese día algún evento -->
						<li value="unknown">	<!-- Se guarda una sola hora -->
							<addtomap>			<!-- Guardar eventos en un mapa con fecha:horas -->
								<name>fecha_horas</name>
								<key><get name="claveFecha"/></key>
								<value><get name="nuevaHora"/></value>
							</addtomap>
						</li>
						<li>					<!-- Ya había eventos, ahora solo se pegan -->
							<modifymap>			<!-- Guardar eventos en un mapa con fecha:horas -->
								<name>fecha_horas</name>
								<key><get name="claveFecha"/></key>
								<value><map name="fecha_horas"><get name="claveFecha">_<get name="nuevaHora"/></map></value>
							</modifymap>
						</li>
					</condition>
					<addtoset>	<!-- Guardar eventos en un set para comprobar si ya está pillado el momento -->
						<name>fecha_hora</name>
						<key><get name="claveFechaHora"/></key>
					</addtoset>
				</think>
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>[Si Exacto Afirmativo Correcto] ^</pattern>
			<that>VALE, LO GUARDO ALGUIEN MAS</that>
			<template>
				Como se llama?
			</template>
		</category>

		<!-- Regla  -->
		<category>
			<pattern>[No Negativo Nope] ^</pattern>
			<that>VALE, LO GUARDO ALGUIEN MAS</that>
			<template>
				Vale, ya esta registrado tu evento en el calendario
				<think>
					<addtomap>	<!-- Guardar eventos en un mapa con fecha_hora:titulo -->
						<name>evento</name>
						<key><get name="claveFechaHora"/></key>
						<value><get name="nuevoTitulo"/></value>
					</addtomap>
					<addtomap>
						<name>evper</name>	<!-- Guardar eventos en un mapa con fecha_hora:invitados -->
						<key><get name="claveFechaHora"/></key>
						<value><get name="nuevoInvitado"/></value>
					</addtomap>
					<set var="condicion"><map name="fecha_horas"><get name="claveFecha"/></map></set>
					<condition var="condicion">	<!-- Comprobar si ya tiene ese día algún evento -->
						<li value="unknown">	<!-- Se guarda una sola hora -->
							<addtomap>			<!-- Guardar eventos en un mapa con fecha:horas -->
								<name>fecha_horas</name>
								<key><get name="claveFecha"/></key>
								<value><get name="nuevaHora"/></value>
							</addtomap>
						</li>
						<li>					<!-- Ya había eventos, ahora solo se pegan -->
							<modifymap>			<!-- Guardar eventos en un mapa con fecha:horas -->
								<name>fecha_horas</name>
								<key><get name="claveFecha"/></key>
								<value><map name="fecha_horas"><get name="claveFecha">_<get name="nuevaHora"/></map></value>
							</modifymap>
						</li>
					</condition>
					<addtoset>	<!-- Guardar eventos en un set para comprobar si ya está pillado el momento -->
						<name>fecha_hora</name>
						<key><get name="claveFechaHora"/></key>
					</addtoset>
				</think>
			</template>
		</category>
	</topic>
	
	</aiml>